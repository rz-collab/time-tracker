<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Time Tracker</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', 'SF Pro Display', sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
      min-height: 100vh;
      overflow: hidden;
      -webkit-app-region: drag;
    }
    button, input, .no-drag { -webkit-app-region: no-drag; }
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0.3; }
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(40,202,65,0.4); }
      50% { opacity: 0.8; box-shadow: 0 0 0 4px rgba(40,202,65,0); }
    }
    input::placeholder { color: #4a4a5a; }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 3px; }
    .blink { animation: blink 1s infinite; }
  </style>
</head>
<body>
  <div id="app"></div>
  <script>
    // Time Tracker App - Pure JavaScript version
    const app = document.getElementById('app');
    
    let state = {
      isRunning: false,
      elapsedTime: 0,
      sessions: [],
      showSessions: false,
      showNameDialog: false,
      pendingSession: null,
      editingSessionId: null,
      editingName: '',
      taskName: '',
      isCompact: false
    };
    
    let interval = null;
    
    function formatTime(totalSeconds) {
      const hours = Math.floor(totalSeconds / 3600).toString().padStart(2, '0');
      const minutes = Math.floor((totalSeconds % 3600) / 60).toString().padStart(2, '0');
      const seconds = (totalSeconds % 60).toString().padStart(2, '0');
      return { hours, minutes, seconds };
    }
    
    function formatDuration(totalSeconds) {
      const { hours, minutes, seconds } = formatTime(totalSeconds);
      if (totalSeconds >= 3600) return `${hours}h ${minutes}m ${seconds}s`;
      if (totalSeconds >= 60) return `${minutes}m ${seconds}s`;
      return `${seconds}s`;
    }
    
    function formatTimeOfDay(date) {
      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: true }).toLowerCase();
    }
    
    function startTimer() {
      state.isRunning = true;
      interval = setInterval(() => {
        state.elapsedTime++;
        render();
      }, 1000);
      render();
    }
    
    function pauseTimer() {
      state.isRunning = false;
      clearInterval(interval);
      render();
    }
    
    function stopTimer() {
      if (state.elapsedTime > 0) {
        state.isRunning = false;
        clearInterval(interval);
        const endTime = new Date();
        const startTime = new Date(endTime.getTime() - state.elapsedTime * 1000);
        state.pendingSession = {
          duration: state.elapsedTime,
          startTime: formatTimeOfDay(startTime),
          endTime: formatTimeOfDay(endTime)
        };
        state.showNameDialog = true;
        render();
      }
    }
    
    function resetTimer() {
      state.isRunning = false;
      clearInterval(interval);
      state.elapsedTime = 0;
      render();
    }
    
    function saveSession() {
      const newSession = {
        id: 'session_' + Date.now(),
        name: state.taskName.trim() || 'Untitled Task',
        duration: state.pendingSession.duration,
        startTime: state.pendingSession.startTime,
        endTime: state.pendingSession.endTime
      };
      state.sessions.push(newSession);
      
      state.taskName = '';
      state.showNameDialog = false;
      state.elapsedTime = 0;
      state.pendingSession = null;
      state.showSessions = true;
      render();
      updateWindowSize();
    }
    
    function discardSession() {
      state.showNameDialog = false;
      state.elapsedTime = 0;
      state.pendingSession = null;
      state.taskName = '';
      render();
    }
    
    function deleteSession(id) {
      state.sessions = state.sessions.filter(s => s.id !== id);
      
      render();
      updateWindowSize();
    }
    
    function startEditing(sessionId) {
      const session = state.sessions.find(s => s.id === sessionId);
      if (session) {
        state.editingSessionId = session.id;
        state.editingName = session.name;
        render();
        setTimeout(() => {
          const input = document.getElementById('edit-input');
          if (input) input.focus();
        }, 0);
      }
    }
    
    function saveEditing() {
      if (state.editingSessionId) {
        state.sessions = state.sessions.map(s => 
          s.id === state.editingSessionId 
            ? { ...s, name: state.editingName.trim() || 'Untitled Task' }
            : s
        );
        
        state.editingSessionId = null;
        state.editingName = '';
        render();
      }
    }
    
    function cancelEditing() {
      state.editingSessionId = null;
      state.editingName = '';
      render();
    }
    
    function toggleSessions() {
      state.showSessions = !state.showSessions;
      render();
      updateWindowSize();
    }
    
    function toggleCompact() {
      state.isCompact = !state.isCompact;
      render();
      updateWindowSize();
    }
    
    function updateWindowSize() {
      if (window.require) {
        const { ipcRenderer } = window.require('electron');
        if (state.isCompact) {
          ipcRenderer.send('resize-window', 220, 44);
        } else {
          // Calculate height based on state
          let height = 220; // base height (title bar + timer + controls + toggle button + padding)
          if (state.showSessions && state.sessions.length > 0) {
            height += Math.min(state.sessions.length * 36, 160) + 10; // session items + border
          }
          ipcRenderer.send('resize-window', 320, height);
        }
      }
    }
    
    function minimizeWindow() {
      // For Electron
      if (window.require) {
        const { ipcRenderer } = window.require('electron');
        ipcRenderer.send('minimize-window');
      }
    }
    
    function closeWindow() {
      // For Electron
      if (window.require) {
        const { ipcRenderer } = window.require('electron');
        ipcRenderer.send('close-window');
      } else {
        window.close();
      }
    }
    
    function render() {
      const time = formatTime(state.elapsedTime);
      const totalTracked = state.sessions.reduce((acc, s) => acc + s.duration, 0);
      
      // Compact mode - just timer and status with controls
      if (state.isCompact) {
        app.innerHTML = `
          <div style="height: 100vh; display: flex; align-items: center; padding: 6px 10px; gap: 10px; -webkit-app-region: drag;">
            <div onclick="toggleCompact()" style="display: flex; align-items: center; gap: 8px; cursor: pointer; flex: 1; -webkit-app-region: no-drag;">
              <span style="font-size: 20px; font-weight: 400; color: #e8e8f0; font-family: 'SF Mono', 'Consolas', monospace;">${time.hours}:${time.minutes}:${time.seconds}</span>
              <div style="width: 7px; height: 7px; border-radius: 50%; background: ${state.isRunning ? '#4ade80' : '#6b6b8a'}; ${state.isRunning ? 'animation: pulse 1.5s infinite;' : ''}"></div>
            </div>
            <div style="display: flex; gap: 2px; -webkit-app-region: no-drag;">
              <button onclick="toggleCompact()" title="Expand" style="width: 22px; height: 18px; background: transparent; border: none; color: #a0a0b8; font-size: 9px; cursor: pointer; display: flex; align-items: center; justify-content: center; border-radius: 2px;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='transparent'">◳</button>
              <button onclick="minimizeWindow()" title="Minimize" style="width: 22px; height: 18px; background: transparent; border: none; color: #a0a0b8; font-size: 11px; cursor: pointer; display: flex; align-items: center; justify-content: center; border-radius: 2px;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='transparent'">─</button>
              <button onclick="closeWindow()" title="Close" style="width: 22px; height: 18px; background: transparent; border: none; color: #a0a0b8; font-size: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; border-radius: 2px;" onmouseover="this.style.background='#e81123';this.style.color='#fff'" onmouseout="this.style.background='transparent';this.style.color='#a0a0b8'">✕</button>
            </div>
          </div>
        `;
        return;
      }
      
      app.innerHTML = `
        <div style="display: flex; flex-direction: column;">
          <!-- Title Bar -->
          <div style="background: linear-gradient(180deg, #3d3d5c 0%, #2a2a42 100%); padding: 6px 8px; display: flex; align-items: center; justify-content: flex-end; border-bottom: 1px solid rgba(0,0,0,0.3); -webkit-app-region: drag;">
            <div style="display: flex; gap: 2px; -webkit-app-region: no-drag;">
              <button onclick="toggleCompact()" title="Compact mode" style="width: 28px; height: 22px; background: transparent; border: none; color: #a0a0b8; font-size: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; border-radius: 3px;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='transparent'">◫</button>
              <button onclick="minimizeWindow()" title="Minimize" style="width: 28px; height: 22px; background: transparent; border: none; color: #a0a0b8; font-size: 14px; cursor: pointer; display: flex; align-items: center; justify-content: center; border-radius: 3px;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='transparent'">─</button>
              <button onclick="closeWindow()" title="Close" style="width: 28px; height: 22px; background: transparent; border: none; color: #a0a0b8; font-size: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; border-radius: 3px;" onmouseover="this.style.background='#e81123';this.style.color='#fff'" onmouseout="this.style.background='transparent';this.style.color='#a0a0b8'">✕</button>
            </div>
          </div>
          
          <!-- Timer Display -->
          <div style="padding: 12px 16px 10px; text-align: center;">
            <div style="display: flex; justify-content: center; align-items: baseline; gap: 2px; font-family: 'SF Mono', 'Consolas', monospace;">
              <span style="font-size: 52px; font-weight: 300; color: #e8e8f0; text-shadow: 0 0 40px rgba(100,180,255,0.3); letter-spacing: -2px;">${time.hours}</span>
              <span style="font-size: 39px; color: #6b6b8a;" class="${state.isRunning ? 'blink' : ''}">:</span>
              <span style="font-size: 52px; font-weight: 300; color: #e8e8f0; text-shadow: 0 0 40px rgba(100,180,255,0.3); letter-spacing: -2px;">${time.minutes}</span>
              <span style="font-size: 39px; color: #6b6b8a;" class="${state.isRunning ? 'blink' : ''}">:</span>
              <span style="font-size: 52px; font-weight: 300; color: #e8e8f0; text-shadow: 0 0 40px rgba(100,180,255,0.3); letter-spacing: -2px;">${time.seconds}</span>
            </div>
          </div>
          
          <!-- Controls -->
          <div style="display: flex; gap: 8px; padding: 0 16px 12px; justify-content: center;">
            ${!state.isRunning ? `
              <button onclick="startTimer()" title="Start" style="width: 42px; height: 42px; font-size: 14px; background: linear-gradient(180deg, #4ade80 0%, #22c55e 100%); color: #052e16; border: none; border-radius: 50%; cursor: pointer; box-shadow: 0 3px 12px rgba(74,222,128,0.3); display: flex; align-items: center; justify-content: center;">▶</button>
            ` : `
              <button onclick="pauseTimer()" title="Pause" style="width: 42px; height: 42px; font-size: 12px; background: linear-gradient(180deg, #60a5fa 0%, #3b82f6 100%); color: #1e3a5f; border: none; border-radius: 50%; cursor: pointer; box-shadow: 0 3px 12px rgba(96,165,250,0.3); display: flex; align-items: center; justify-content: center;">❚❚</button>
              <button onclick="stopTimer()" title="Stop & Save" style="width: 42px; height: 42px; font-size: 12px; background: linear-gradient(180deg, #f87171 0%, #ef4444 100%); color: #450a0a; border: none; border-radius: 50%; cursor: pointer; box-shadow: 0 3px 12px rgba(248,113,113,0.3); display: flex; align-items: center; justify-content: center;">◼</button>
            `}
            <button onclick="resetTimer()" title="Reset" style="width: 42px; height: 42px; font-size: 16px; background: linear-gradient(180deg, #fbbf24 0%, #f59e0b 100%); color: #451a03; border: none; border-radius: 50%; cursor: pointer; box-shadow: 0 3px 12px rgba(251,191,36,0.3); display: flex; align-items: center; justify-content: center;">↺</button>
          </div>
          
          <!-- Toggle Sessions -->
          <div style="padding: 0 16px 10px;">
            <button onclick="toggleSessions()" style="width: 100%; padding: 6px; font-size: 11px; font-weight: 500; background: rgba(255,255,255,0.03); color: #6b6b8a; border: 1px solid rgba(255,255,255,0.08); border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px;">
              <span style="transform: rotate(${state.showSessions ? '180deg' : '0deg'}); display: inline-block; font-size: 8px;">▼</span>
              Sessions (${state.sessions.length})
              ${state.sessions.length > 0 ? `<span style="color: #4ade80;">• ${formatDuration(totalTracked)}</span>` : ''}
            </button>
          </div>
          
          <!-- Sessions List -->
          ${state.showSessions && state.sessions.length > 0 ? `
            <div style="border-top: 1px solid rgba(255,255,255,0.05); background: rgba(0,0,0,0.15); max-height: 160px; overflow-y: auto;">
              ${state.sessions.map((session, index) => `
                <div style="padding: 8px 16px; display: flex; align-items: center; gap: 8px; border-bottom: ${index < state.sessions.length - 1 ? '1px solid rgba(255,255,255,0.03)' : 'none'};">
                  <div style="width: 5px; height: 5px; border-radius: 50%; background: #4ade80; flex-shrink: 0;"></div>
                  <div style="flex: 1; min-width: 0; overflow: hidden;">
                    ${state.editingSessionId === session.id ? `
                      <input id="edit-input" type="text" value="${state.editingName}" 
                        oninput="state.editingName=this.value"
                        onkeydown="if(event.key==='Enter')saveEditing();if(event.key==='Escape')cancelEditing();"
                        onblur="saveEditing()"
                        style="width: 100%; padding: 2px 6px; font-size: 12px; background: rgba(0,0,0,0.4); border: 1px solid rgba(74,222,128,0.5); border-radius: 3px; color: #e8e8f0; outline: none; box-sizing: border-box;">
                    ` : `
                      <div class="no-drag" ondblclick="startEditing('${session.id}')" style="color: #e8e8f0; font-size: 12px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; cursor: pointer;" title="Double-click to edit">${session.name}</div>
                    `}
                    <div style="color: #6b6b8a; font-size: 10px; margin-top: 2px;">${session.startTime}–${session.endTime}</div>
                  </div>
                  <div style="color: #a0a0b8; font-size: 11px; font-weight: 600; font-family: 'SF Mono', 'Consolas', monospace; flex-shrink: 0;">${formatDuration(session.duration)}</div>
                  <button onclick="deleteSession('${session.id}')" style="background: none; border: none; color: #6b6b8a; cursor: pointer; padding: 2px; font-size: 12px; opacity: 0.4;" onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0.4">×</button>
                </div>
              `).join('')}
            </div>
          ` : ''}
        </div>
        
        <!-- Save Dialog -->
        ${state.showNameDialog ? `
          <div style="position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; z-index: 100;">
            <div style="width: 300px; background: linear-gradient(180deg, #2d2d44 0%, #1e1e32 100%); border-radius: 8px; box-shadow: 0 25px 80px rgba(0,0,0,0.6); overflow: hidden;">
              <div style="padding: 14px; border-bottom: 1px solid rgba(255,255,255,0.05); text-align: center;">
                <div style="display: flex; align-items: center; justify-content: center; gap: 12px;">
                  <span style="color: #4ade80; font-size: 20px; font-weight: 300; font-family: 'SF Mono', 'Consolas', monospace;">${formatDuration(state.pendingSession?.duration || 0)}</span>
                  <span style="color: #6b6b8a; font-size: 11px;">${state.pendingSession?.startTime}–${state.pendingSession?.endTime}</span>
                </div>
              </div>
              <div style="padding: 14px;">
                <input id="task-name-input" type="text" value="${state.taskName}" 
                  oninput="state.taskName=this.value"
                  onkeydown="if(event.key==='Enter')saveSession()"
                  placeholder="What were you working on?"
                  style="width: 100%; padding: 10px 12px; font-size: 13px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 5px; color: #e8e8f0; outline: none; box-sizing: border-box;">
              </div>
              <div style="display: flex; gap: 8px; padding: 0 14px 14px;">
                <button onclick="discardSession()" style="flex: 1; padding: 10px; font-size: 12px; font-weight: 600; background: transparent; color: #a0a0b8; border: 1px solid rgba(255,255,255,0.1); border-radius: 5px; cursor: pointer;">Discard</button>
                <button onclick="saveSession()" style="flex: 1; padding: 10px; font-size: 12px; font-weight: 600; background: linear-gradient(180deg, #4ade80 0%, #22c55e 100%); color: #052e16; border: none; border-radius: 5px; cursor: pointer; box-shadow: 0 3px 12px rgba(74,222,128,0.3);">Save</button>
              </div>
            </div>
          </div>
        ` : ''}
      `;
      
      // Focus task name input when dialog opens
      if (state.showNameDialog) {
        setTimeout(() => {
          const input = document.getElementById('task-name-input');
          if (input) input.focus();
        }, 0);
      }
    }
    
    // Initial render
    render();
    
    // Make functions globally accessible for inline event handlers
    window.startTimer = startTimer;
    window.pauseTimer = pauseTimer;
    window.stopTimer = stopTimer;
    window.resetTimer = resetTimer;
    window.saveSession = saveSession;
    window.discardSession = discardSession;
    window.deleteSession = deleteSession;
    window.startEditing = startEditing;
    window.saveEditing = saveEditing;
    window.cancelEditing = cancelEditing;
    window.toggleSessions = toggleSessions;
    window.toggleCompact = toggleCompact;
    window.minimizeWindow = minimizeWindow;
    window.closeWindow = closeWindow;
    window.state = state;
  </script>
</body>
</html>
